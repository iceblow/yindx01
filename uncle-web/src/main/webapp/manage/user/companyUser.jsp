<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>
	<div class="row">
		<div id="replyModalTO">
			<form id="" role="form" action="" enctype="multipart/form-data"
				method="post">
				<div class="modal-body form-horizontal row">

					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司名称</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="name" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司分类</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="type" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">简介</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="profile" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司所在城市</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="city" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司手机号码</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="phone" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">经度坐标</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="longitude" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">纬度坐标</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="latitude" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司成立时间</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="yearCreate" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司人员规模</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="peopleCount" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司详细地址</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="address" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">联系人</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="relationPeople" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">联系人电话</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="relationPhone" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司状态</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="stateDel" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">单位头衔</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="title" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">星级</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="star" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">主营业务</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="mainBusiness" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">公司详细描述</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="companyDetail" value="" readonly="readonly">
							</div>
						</div>
					</div>
					<div class=" col-sm-6">
						<div class=" form-xs form-group row">
							<label for="addGrade" class="col-xs-4 control-label">添加的时间</label>
							<div class="col-xs-8">
								<input type="text " class="form-control input-xs maskId"
									id="addtime" value="" readonly="readonly">
							</div>
						</div>
					</div>
					

				</div>
			</form>
		</div>
		<form id="manageForm" class="form-horizontal" role="form">
			<div class="col-xs-4">
				<div class="form-group">
					<label class="col-sm-4 control-label no-padding-right"
						for="form-field-6" style="font-weight: bold">姓名</label>
					<div class="col-sm-8">
						<input data-rel="tooltip" type="text" class="col-sm-10 searchKey"
							onBlur="replaceSpace(this)" name="name" title="姓名"
							data-placement="bottom">
					</div>
				</div>
			</div>
			<div class="col-xs-4">
				<div class="form-group">
					<label class="col-sm-4 control-label no-padding-right"
						for="form-field-6" style="font-weight: bold">手机号</label>
					<div class="col-sm-8">
						<input data-rel="tooltip" type="text" class="col-sm-10 searchKey"
							onBlur="replaceSpace(this)" name="phone" title="手机号"
							data-placement="bottom">
					</div>
				</div>
			</div>
		</form>
		<div class="col-xs-12">
			<!-- PAGE CONTENT BEGINS -->
			<table id="grid-table"></table>
			<div id="grid-pager"></div>
		</div>
		<!-- /.col -->
	</div>
	<!-- /.row -->
	<script type="text/javascript">
		$(document).ready(
				function() {

					var rowDataNames = [];

					$("#grid-table").jqGrid(
							{
								url : './user/getCompanyUser',
								datatype : "json",
								page : '${page}',
								colModel : [ {
									label : '公司名称',
									name : 'name',
									width : 50
								}, {
									label : '手机号',
									name : 'phone',
									width : 50
								}, {
									label : '所在地',
									name : 'city',
									width : 50
								}, {
									label : '人员规模',
									name : 'peopleCount',
									width : 50
								}, {
									label : '地址',
									name : 'address',
									width : 50
								}, {
									label : '添加时间',
									name : 'addtimes',
									width : 50
								}, {
									label : '操作',
									name : '',
									width : 80,
									formatter : changestatus
								}, ],
								multiselect : true,
								multiboxonly : true,
								onSelectRow : function(rowId, status, e) {
									rowDataNames = [];
									var rowIds = jQuery("#jqGrid").jqGrid(
											'getGridParam', 'selarrrow');
									$(rowIds).each(
											function(i, rowId) {
												rowDataNames.push($("#jqGrid")
														.jqGrid('getRowData',
																rowId))
											});
								},
								viewrecords : true, // show the current page, data rang and total records on the toolbar
								rowList : [ 10, 20, 30 ],
								autowidth : true,
								height : $(window).height() - 300,
								rowNum : 10,
								pager : "#grid-pager",
								jsonReader : {
									root : 'rows',
									repeatitems : false,
									page : "page", // json中代表当前页码的数据  
									records : "records", // json中代表数据行总数的数据 
									total : "total"
								},
								loadComplete : function() {
									var table = this;
									setTimeout(function() {
										// 								styleCheckbox(table);
										// 								updateActionIcons(table);
										updatePagerIcons(table);
										// 								enableTooltips(table);
									}, 0);
								},
							});

					$('[data-rel=tooltip]').tooltip({
						container : 'body'
					});

					initButton([ {
						name : "查询",
						click : function() {
							searchFrom('./user/getCompanyUser?');
						}
					} ])
				});
		function replaceSpace(obj) {
			obj.value = obj.value.replace(/(^\s*)|(\s*$)/g, "");
		}
		$("#replyModalTO").dialog({
			autoOpen : false,
			height : 600,
			width : 1000,
			modal : true,
			title : '',
			buttons : {
				"关闭" : function() {
					$("#replyModalTO").dialog("close");
				}
			},
			show : {
				effect : "blind",
				duration : 100
			},
			hide : {
				effect : "blind",
				duration : 50
			}
		});

		//加载图片
		function loadpicture(cellvalue, options, rowObject) {
			var html = '';
			html += '<img src=\''+rowObject.listpicurl +'\' style="height: 100px; width: 100px;">';
			return html;
		}
		

		function changestatus(cellvalue, options, rowObject) {
			var stateDel = rowObject.stateDel;
			var stateStr = '';
			if (stateDel == 0) {
				stateStr = "审核通过";
			}
			if (stateDel == 1) {
				stateStr = "冻结";
			}
			if (stateDel == 2) {
				stateStr = "解除冻结";
			}
			var html = '';
			html += '<button class="btn btn-xs btn-primary" style="margin-right:10px;" onclick="detail(\''
					+ rowObject.companyid + '\')">查看详情</button>';
			html += '<button class="btn btn-xs btn-primary" style="margin-right:10px;" onclick="changeStateDel(\''
					+ rowObject.companyid
					+ '\',\''
					+ stateDel
					+ '\',\''
					+ stateStr + '\')">' + stateStr + '</button>';
			if (stateDel == 0) {
				html += '<button class="btn btn-xs btn-primary" style="margin-right:10px;" onclick="del(\''
						+ rowObject.companyid + '\')">删除</button>';
			}
			return html;
		}
		function changeStateDel(companyid, stateDel, stateStr) {
			if (!confirm("确定" + stateStr + "吗")) {
				return;
			}
			$.ajax({
				url : './user/updateCompanyUserState?',
				data : {
					companyid : companyid,
					stateDel : stateDel
				},
				success : function() {
					alert("修改成功");
					window.location.reload();
				}
			})
		}

		function detail(id) {
			$("#replyModalTO").dialog("open");
			$.ajax({
				url : './user/getCompanyUserByid',
				data : {
					id : id
				},
				success : function(msg) {
					if (msg != null) {
						console.log(msg);
						$('#name').val(msg.name);
						$('#type').val(msg.types);
						$('#profile').val(msg.profile);
						$('#city').val(msg.city);
						$('#phone').val(msg.phone);
						$('#longitude').val(msg.longitude);
						$('#latitude').val(msg.latitude);
						$('#yearCreate').val(msg.yearCreates);
						$('#peopleCount').val(msg.peopleCount);
						$('#address').val(msg.address);
						$('#relationPeople').val(msg.relationPeople);
						$('#relationPhone').val(msg.relationPhone);
						$('#stateDel').val(msg.stateDels);
						$('#title').val(msg.titles);
						$('#star').val(msg.star);
						$('#mainBusiness').val(msg.mainBusiness);
						$('#companyDetail').val(msg.companyDetail);
						$('#addtime').val(msg.addtimes);
					}
				}
			})
		}

		function del(id) {
			var bool = confirm("是否确认删除？");
			if (bool == true) {
				$.ajax({
					url : "./user/deluser",
					type : "post",
					data : {
						companyid : id
					},
					success : function(code) {
						if (code == 0) {
							alert("删除失败");
							return;
						} else {
							alert("删除成功");
							loadHtml("./user/companyUser");
						}
					}
				});
			}
			return;
		}
	</script>
</body>
</html>